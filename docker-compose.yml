services:
  # The Communication Hub
  relay:
    image: rnostr/rnostr:latest
    container_name: msp-nostr-relay
    ports:
      - "8081:8080" # Host:8081 -> Container:8080
    volumes:
      - ./data/relay:/data
    restart: unless-stopped

  sol:
    build: .
    container_name: nanobot-sol
    command: gateway --port 18790
    ports:
      - "18791:18790"
    environment:
      - NANOBOT_NAME=Sol
      # Identity Fetch via Nostr
      - NANOBOT_SOUL_ID=sol
      - NANOBOT_MASTER_KEY=correct-horse-battery-staple
      # Nostr Config
      - NANOBOT_CHANNELS__NOSTR__ENABLED=true
      - NANOBOT_CHANNELS__NOSTR__RELAY_URL=ws://msp-nostr-relay:8080
      # Telegram Disabled
      - NANOBOT_CHANNELS__TELEGRAM__ENABLED=false
      # Model Config
      - NANOBOT_PROVIDERS__CUSTOM__API_KEY=${MSPBOTS_API_KEY}
      - NANOBOT_PROVIDERS__CUSTOM__API_BASE=https://aigateway.mspbots.ai/v1
      - NANOBOT_AGENTS__DEFAULTS__MODEL=msp_gemini/gemini-3-pro-preview
    volumes:
      # Removed souls mount to force remote fetch
      - ./data/sol/memory:/root/.nanobot/memory
      - ./data/sol/workspace:/root/.nanobot/workspace
      # Mother Powers
      - /var/run/docker.sock:/var/run/docker.sock
      - ./data/mother:/app/data/mother
    depends_on:
      - relay
    restart: unless-stopped

  alice:
    build: .
    container_name: nanobot-alice
    command: gateway --port 18790
    ports:
      - "18792:18790"
    environment:
      - NANOBOT_NAME=Alice
      # Identity Fetch via Nostr
      - NANOBOT_SOUL_ID=alice
      - NANOBOT_MASTER_KEY=correct-horse-battery-staple
      # Nostr Config
      - NANOBOT_CHANNELS__NOSTR__ENABLED=true
      - NANOBOT_CHANNELS__NOSTR__RELAY_URL=ws://msp-nostr-relay:8080
      # Telegram Disabled
      - NANOBOT_CHANNELS__TELEGRAM__ENABLED=false
      # Model Config
      - NANOBOT_PROVIDERS__CUSTOM__API_KEY=${MSPBOTS_API_KEY}
      - NANOBOT_PROVIDERS__CUSTOM__API_BASE=https://aigateway.mspbots.ai/v1
      - NANOBOT_AGENTS__DEFAULTS__MODEL=msp_gemini/gemini-3-pro-preview
    volumes:
      # Removed souls mount to force remote fetch
      - ./data/alice/memory:/root/.nanobot/memory
      - ./data/alice/workspace:/root/.nanobot/workspace
    depends_on:
      - relay
    restart: unless-stopped
